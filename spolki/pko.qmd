---
title: "PKO Bank Polski S.A. (PKO)"
format: 
  dashboard:
    orientation: columns
    nav-buttons: [github]
---

```{r setup, include=FALSE}
library(tidyverse)
library(plotly)
library(xts)
library(TTR)

get_stock_data <- function(ticker) {
  prices_all <- readRDS("../data/prices100.RDS")
  col_idx <- which(names(prices_all) == ticker)
  if(length(col_idx) == 0) return(NULL)
  df <- prices_all[, c(1, col_idx)]
  names(df) <- c("date", "price")
  df <- df %>% filter(!is.na(price))
  return(df)
}

stock_data <- get_stock_data("PKO")
last_row <- tail(stock_data, 1)
last_price <- last_row$price
last_date <- last_row$date
prev_price <- tail(stock_data$price, 2)[1]
change_pct <- round((last_price - prev_price) / prev_price * 100, 2)
y_ago_idx <- nrow(stock_data) - 252
change_yy <- if(y_ago_idx > 0) round((last_price - stock_data$price[y_ago_idx]) / stock_data$price[y_ago_idx] * 100, 2) else "N/A"
title_lp <- paste0("Cena (", last_date, ")")
```

## Column {width=100%}

### Row {height=8%}

::: {.card}
<div style="font-size: 0.85em; display: flex; justify-content: space-around; align-items: center; padding: 5px;">
  <span>**Ticker:** PKO</span>
  <span>**PKO Bank Polski S.A.**</span>
  <span>**Siedziba:** Warszawa</span>
  <span>**WWW:** [pkobp.pl](https://pkobp.pl)</span>
  <span>**Branża:** [Finanse](../spolki-gpw.qmd?branza=Finanse)</span>
  <span>**Podbranża:** [Banki uniwersalne](../spolki-gpw.qmd?podbranza=banki+uniwersalne)</span>
</div>
:::

### Row {height=92%}

#### Column {width=22%}

```{r}
#| content: valuebox
#| title: !expr title_lp
list(icon = "currency-exchange", color = "primary", value = paste0(round(last_price, 2), " PLN"))
```

<style>.value-box .value-box-value { font-size: 1.8em !important; } .value-box .value-box-title { font-size: 0.8em !important; }</style>

```{r}
#| content: valuebox
#| title: "Zmiana d/d"
list(icon = "graph-up", color = if(change_pct >= 0) "success" else "danger", value = paste0(change_pct, "%"))
```

```{r}
#| content: valuebox
#| title: "Zmiana y/y"
list(icon = "calendar-check", color = if(is.numeric(change_yy) && change_yy >= 0) "success" else if(is.numeric(change_yy)) "danger" else "secondary", value = if(is.numeric(change_yy)) paste0(change_yy, "%") else change_yy)
```

#### Column {width=78% .tabset}

::: {.card title="Notowania"}
```{r}
stock_xts <- xts(stock_data$price, order.by = as.Date(stock_data$date))
sma200 <- SMA(stock_xts, n = 200)
plot_ly(x = index(stock_xts), y = as.numeric(stock_xts), type = 'scatter', mode = 'lines', name = 'Cena PKO') %>%
  add_lines(x = index(stock_xts), y = as.numeric(sma200), name = 'SMA 200', line = list(color = 'orange')) %>%
  layout(xaxis = list(title = ""), yaxis = list(title = "Cena (PLN)"), legend = list(orientation = 'h', x = 0.1, y = 1.1), margin = list(t = 50))
```
:::

::: {.card title="O spółce"}
PKO Bank Polski to lider sektora bankowego w Polsce, obsługujący blisko 12 mln klientów. Jest kluczową instytucją finansową o charakterze uniwersalnym, działającą w segmencie detalicznym, korporacyjnym i inwestycyjnym. 
:::

::: {.card title="Usługi i Segmenty"}
Bank oferuje pełen zakres produktów finansowych, od kont i kredytów po zaawansowane usługi bankowości inwestycyjnej. Lider nowoczesnych kanałów cyfrowych z najpopularniejszą aplikacją mobilną na rynku polskim (IKO).
:::

::: {.card title="Wizja"}
Dążenie do bycia najbardziej nowoczesnym i przyjaznym bankiem w regionie, wspierającym transformację cyfrową i energetyczną klientów.

::: {.callout-important}
## Informacja prawna
Materiały publikowane na tej stronie mają charakter wyłącznie informacyjny i edukacyjny. Nie stanowią porady inwestycyjnej.
:::
:::
