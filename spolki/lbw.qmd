---
title: "Lubawa S.A. (LBW)"
format: 
  dashboard:
    orientation: columns
    nav-buttons: [github]
---

```{r setup, include=FALSE}
library(tidyverse)
library(plotly)
library(xts)
library(TTR)

# Funkcja pomocnicza do ładowania danych
get_stock_data <- function(ticker) {
  prices_all <- readRDS("../data/prices100.RDS")
  col_idx <- which(names(prices_all) == ticker)
  
  if(length(col_idx) == 0) return(NULL)
  
  df <- prices_all[, c(1, col_idx)]
  names(df) <- c("date", "price")
  df <- df %>% filter(!is.na(price))
  return(df)
}

lbw_data <- get_stock_data("LBW")
last_row <- tail(lbw_data, 1)
last_price <- last_row$price
last_date <- last_row$date

# Obliczenia zmian
prev_price <- tail(lbw_data$price, 2)[1]
change_pct <- round((last_price - prev_price) / prev_price * 100, 2)

# Zmiana y/y
y_ago_idx <- nrow(lbw_data) - 252
if(y_ago_idx > 0) {
  y_ago_price <- lbw_data$price[y_ago_idx]
  change_yy <- round((last_price - y_ago_price) / y_ago_price * 100, 2)
} else {
  change_yy <- "N/A"
}
```

<style>
/* Faza 1: Ukrycie tytułów systemowych */
.value-box .value-box-title {
  display: none !important;
}

/* Faza 2: Stylizacja wartości z oznaczeniem d/d / y/y */
.value-box .value-box-value {
  font-size: 1.5em !important;
  line-height: 1.2 !important;
  display: block !important;
}

/* Faza 3: Naprawa ucinania - puste miejsce na dole kafelka */
.value-box-area {
  padding-bottom: 20px !important;
}
</style>

## Column {width=30%}

### Informacje o spółce

**Ticker:** LBW  
**Siedziba:** Ostrów Wielkopolski  
**WWW:** [lubawagroup.com](https://lubawagroup.com/)

**Branża:** [Przemysł i produkcja](../spolki-gpw.qmd?branza=Przemysł+i+produkcja)  
**Podbranża:** [Lotnictwo i obronność](../spolki-gpw.qmd?podbranza=Lotnictwo+i+obronność)

---

```{r}
#| content: valuebox
#| title: ""
list(
  icon = "currency-exchange",
  color = "primary",
  value = paste0(round(last_price, 2), " PLN")
)
```

```{r}
#| content: valuebox
#| title: ""
list(
  icon = "graph-up",
  color = if(change_pct >= 0) "success" else "danger",
  value = paste0(change_pct, "% d/d")
)
```

```{r}
#| content: valuebox
#| title: ""
list(
  icon = "calendar-check",
  color = if(is.numeric(change_yy) && change_yy >= 0) "success" else if(is.numeric(change_yy)) "danger" else "secondary",
  value = if(is.numeric(change_yy)) paste0(change_yy, "% y/y") else "N/A y/y"
)
```

### Status i Dane

Dane aktualne na: **`r last_date`**

## Column {width=70% .tabset}

### Notowania

```{r}
#| title: Wykres historyczny z SMA200
lbw_xts <- xts(lbw_data$price, order.by = as.Date(lbw_data$date))
sma200 <- SMA(lbw_xts, n = 200)

plot_ly(x = index(lbw_xts), y = as.numeric(lbw_xts), type = 'scatter', mode = 'lines', name = 'Cena LBW') %>%
  add_lines(x = index(lbw_xts), y = as.numeric(sma200), name = 'SMA 200', line = list(color = 'orange')) %>%
  layout(
    xaxis = list(title = "", rangeslider = list(visible = TRUE)),
    yaxis = list(title = "Cena (PLN)"),
    legend = list(orientation = 'h', x = 0.1, y = 1.1),
    margin = list(t = 50)
  )
```

<div style="font-size: 0.85em; color: #666; margin-top: 15px; padding: 10px; border-top: 1px solid #eee;">
**Informacja prawna:** Materiały mają charakter wyłącznie informacyjny i edukacyjny. Nie stanowią porady inwestycyjnej.
</div>

### O spółce

**Lubawa S.A.** to jeden z najważniejszych polskich producentów konfekcji technicznej dla sektora obronnego i ratownictwa. Spółka dostarcza innowacyjne rozwiązania w zakresie ochrony balistycznej (kamizelki, hełmy), osłon pojazdów oraz makiet pneumatycznych. Posiada rozwinięte zaplecze R&D oraz własne moce produkcyjne w zakresie tkanin technicznych.

### Wizja i rozwój

*   **NATO i Obronność:** Dążenie do statusu kluczowego dostawcy wyposażenia dla armii sojuszniczych.
*   **Globalna Marka:** Ekspansja na rynki pozaeuropejskie (USA).
*   **Innowacyjność:** Prace nad nowymi kompozytami balistycznymi.
